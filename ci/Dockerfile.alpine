FROM alpine:3.15.4 as stage
ARG RUST_TRIPLET

RUN apk update
RUN apk add clang
RUN apk add bash
COPY ./ci/rust.sh .
RUN ./rust.sh ${RUST_TRIPLET}

COPY . .
RUN make one
RUN ls -lahR

FROM scratch AS export
ARG PLATFORM
COPY --from=stage * ./${PLATFORM}/
